var activeServer,activeChannel,token,socket,userProfile,converter=new showdown.Converter,cache={users:[],channels:[],categories:[],servers:[],messages:[]},activeReplies=[],emojis={},activeRequests=0,currentlyTyping=[],mutedChannels=[],mutedServers=[],unreads=[],unreadChannels=[],cssVars=getComputedStyle(document.querySelector(":root")),keysDown=[],sendRawJSON=!1,ordering=[],isMessageSending=!1;function cacheLookup(n,a,e=null){if("members"===n||"roles"===n){for(let t=0;t<cache.servers.length;t++)if(cache.servers[t][0]===e){var s="members"===n?4:3;if("members"===n){for(let e=0;e<cache.servers[t][s].length;e++)if(cache.servers[t][s][e]._id.user===a)return cache.servers[t][s][e]}else for(const r in cache.servers[t][s])if(r===a)return cache.servers[t][s][r]}}else for(let e=0;e<cache[n].length;e++)if(cache[n][e][0]===a)return cache[n][e];return 1}async function userLookup(e){return 1!==cacheLookup("users",e)?cacheLookup("users",e):(e=[(user=await fetchResource("users/"+e))._id,user.username,user.avatar,user.bot,user.discriminator,user.display_name||user.username,user.relationship],cache.users.push(e),e)}function cacheIndexLookup(t,n){for(let e=0;e<cache[t].length;e++)if(cache[t][e][0]===n)return e;return 1}async function fetchResource(e){return await fetch("https://api.revolt.chat/"+e,{headers:{"x-session-token":token},method:"GET"}).then(e=>e.json()).catch(e=>(console.log(e),!1))}async function updateUnreads(t,n){for(let e=0;e<unreads.length;e++)if(unreads[e]._id.channel===t)return unreads[e].last_id=n,0;return 1}async function loadSyncSettings(){var e=await fetch("https://api.revolt.chat/sync/settings/fetch",{headers:{"x-session-token":token},body:JSON.stringify({keys:["theme","notifications","ordering"]}),method:"POST"}).then(e=>e.json()),t=(fetch("https://api.revolt.chat/sync/unreads",{headers:{"x-session-token":token},method:"GET"}).then(e=>e.json()).then(e=>{unreads=e}),JSON.parse(e.theme[1])["appearance:theme:overrides"]);let n=JSON.parse(e.notifications[1]);ordering=JSON.parse(e.ordering[1]).servers,Object.keys(n.channel).forEach(e=>{"muted"===n.channel[e]&&mutedChannels.push(e)}),Object.keys(n.server).forEach(e=>{"muted"===n.server[e]&&mutedServers.push(e)}),1==toggleTheme.checked&&((e=document.querySelector(":root")).style.setProperty("--accent",t.accent),e.style.setProperty("--error",t.error),e.style.setProperty("--servers-bg",t.background),e.style.setProperty("--channels-bg",t["secondary-background"]),e.style.setProperty("--secondary-background",t["message-box"]),e.style.setProperty("--background",t["primary-background"]),e.style.setProperty("--foreground",t.foreground),e.style.setProperty("--hover",t.hover),document.querySelector("#themeLabel").textContent="Revolt theme")}async function bonfire(){(socket=new WebSocket("wss://ws.revolt.chat")).addEventListener("open",async function(e){socket.send(`{"type": "Authenticate","token": "${token}"}`)}),socket.addEventListener("message",async function(e){var t,n,a,s,r,c=document.getElementById("typingBar"),o=JSON.parse(e.data);switch(o.type){case"Authenticated":document.getElementById("status").innerText="Connected";break;case"Message":o.channel===activeChannel?(parseMessage(o),fetch(`https://api.revolt.chat/channels/${activeChannel}/ack/`+o._id,{headers:{"x-session-token":token},method:"PUT"})):((channel=document.getElementById(o.channel))&&(channel.style.color=o.mentions&&-1!==o.mentions.indexOf(userProfile._id)?cssVars.getPropertyValue("--accent"):cssVars.getPropertyValue("--foreground"),channel.classList.add("channel-unread")),document.getElementById(cacheLookup("channels",o.channel)[3]).style.boxShadow=o.mentions&&-1!==o.mentions.indexOf(userProfile._id)?cssVars.getPropertyValue("--accent"):cssVars.getPropertyValue("--foreground"));break;case"MessageDelete":o.channel_id===activeChannel&&document.querySelector("#messagesContainer").removeChild(document.getElementById(o.id));break;case"MessageUpdate":o.channel_id===activeChannel&&parseMessage(o.data,o.id);case"ChannelAck":updateUnreads(o.id,o.message_id),(channel=document.getElementById(o.id))&&(channel.style.colour=cssVars.getPropertyValue("--foreground"),channel.classList.remove("channel-unread")),document.getElementById(cacheLookup("channels",o.id)[3]).style.boxShadow="rgba(0, 0, 0, 0.16) 0px 1px 4px, rgb(51, 51, 51) 0px 0px 0px 3px";break;case"Error":document.querySelector("#errorContainer").style.display="block",document.querySelector("#errorContent").textContent=o.error;break;case"Ready":buildServerCache(o.servers),buildChannelCache(o.channels),buildUserCache(o.users),getServers();break;case"ChannelStartTyping":o.id===activeChannel&&-1===currentlyTyping.indexOf(o.user)&&(r=cacheLookup("members",o.user,activeServer),t=await userLookup(o.user),n=document.createElement("div"),a=document.createElement("span"),(s=document.createElement("img")).src=void 0===r[2]?`https://autumn.revolt.chat/avatars/${t[2]._id}?max_side=25`:`https://autumn.revolt.chat/avatars/${r[2]._id}?max_side=25`,n.appendChild(s),a.textContent=t[1],n.appendChild(a),n.id=t[0],currentlyTyping.push(o.user),c.appendChild(n),document.getElementById("typingBarContainer").style.display="flex",scrollChatToBottom());break;case"ChannelStopTyping":o.id===activeChannel&&((r=document.getElementById(o.user))&&(r.remove(),currentlyTyping.splice(currentlyTyping.indexOf(o.user),1)),0===c.children.length)&&(document.getElementById("typingBarContainer").style.display="none")}}),socket.addEventListener("error",async function(e){document.getElementById("error")})}async function login(){var e=document.querySelector("#toggleToken");if(document.getElementById("token").value||token)token=token||document.getElementById("token").value;else{if(""==document.getElementById("email").value||""==document.getElementById("password").value)return void console.log("No login method provided, how the fuck do you expect to log in?");var t=await fetch("https://api.revolt.chat/auth/session/login",{method:"POST",body:JSON.stringify({email:document.getElementById("email").value,password:document.getElementById("password").value,friendly_name:"Retaped"})}).then(e=>e.json()).then(e=>e);"Success"===t.result?token=t.token:"Unauthorized"===t.result&&(localStorage.removeItem("token"),console.log("Invalid token!"))}!1===(userProfile=await fetchResource("users/@me"))?console.log("Login failed"):(1!=e.checked||localStorage.getItem("token")||localStorage.setItem("token",token),loadSyncSettings(),bonfire(),fetch("./emojis.json").then(e=>e.json()).then(e=>emojis=e),document.querySelector(".login-screen").style.display="none",document.getElementById("app").style.display="grid")}async function getServers(){var a,s=document.getElementById("serversContainer");s.replaceChildren(),unreads.forEach(e=>{e.last_id<cacheLookup("channels",e._id.channel)[4]&&-1===mutedChannels.indexOf(e._id.channel)&&unreadChannels.push(e._id.channel)});for(let n=0;n<ordering.length;n++){let t=document.createElement("button"),e=cacheIndexLookup("servers",ordering[n]);t.onclick=()=>{activeServer=cache.servers[e][0],getChannels(cache.servers[e][0]),clearMessages(),document.getElementById("serverName").innerText=cache.servers[e][1],document.getElementById("channelName").innerText=""},cache.servers[e][6].forEach(e=>{-1!==unreadChannels.indexOf(e)&&-1===mutedChannels.indexOf(e)&&(t.style.boxShadow=cssVars.getPropertyValue("--foreground")+" 0px 0px 0px 3px")}),-1!==mutedServers.indexOf(cache.servers[e][0])&&(t.style.boxShadow="hsl(0, 0%, 20%) 0px 0px 0px 3px"),t.id=cache.servers[e][0],null==cache.servers[e][2]?t.innerText=cache.servers[e][1].charAt(0):((a=document.createElement("img")).classList.add("serverIcon"),a.src=`https://autumn.revolt.chat/icons/${cache.servers[e][2]}?max_side=64`,t.appendChild(a)),s.appendChild(t)}}async function getChannels(c){let o=document.getElementById("channelsContainer"),l=(o.replaceChildren(),[]);cache.servers[cacheIndexLookup("servers",activeServer)][5].forEach(t=>{var n=document.createElement("details"),e=document.createElement("summary");n.open=!0,n.classList.add("channel-category"),e.textContent=t.title,e.classList.add("categoryText"),n.appendChild(e);for(let e=0;e<t.channels.length;e++){const r=cacheLookup("channels",t.channels[e]);var a=document.createElement("button"),s=document.createElement("span");if("TextChannel"===r[2]&&r[3]===c){l.push(r[0]),a.classList.add("channel"),a.onclick=()=>{getMessages(r[0]),document.getElementById("channelName").innerText=r[1]},a.id=r[0],s.innerText=r[1];for(let e=0;e<unreads.length;e++)if(unreads[e]._id.channel===r[0]){-1===mutedChannels.indexOf(r[0])&&r[4]>unreads[e].last_id&&(a.style.fontWeight="bold");break}a.appendChild(s),-1!==mutedChannels.indexOf(r[0])&&(a.style.color="#777777"),n.appendChild(a)}}o.appendChild(n)});var t=cache.channels,n=document.createElement("details"),e=document.createElement("summary");n.open=!0,n.classList.add("channel-category"),e.textContent="Uncategorised",e.classList.add("categoryText"),n.appendChild(e);for(let e=0;e<t.length;e++)if(t[e][3]===c&&"TextChannel"===t[e][2]&&-1===l.indexOf(t[e][0])){var a=cacheLookup("channels",t[e][0]);if("TextChannel"===a[2]&&a[3]===c){l.push(a[0]);var s=document.createElement("button");s.classList.add("channel");for(let e=0;e<unreads.length;e++)if(unreads[e]._id.channel===a[0]){-1===mutedChannels.indexOf(a[0])&&a[4]>unreads[e].last_id&&(s.style.fontWeight="bold");break}var r=document.createElement("span");r.id=a[0],r.innerText=a[1],s.appendChild(r),n.appendChild(s)}}o.insertBefore(n,o.children[0])}function clearMessages(){document.getElementById("messagesContainer").replaceChildren()}async function parseMessage(t,e=0){var n=cacheLookup("members",t.author,activeServer),a=document.getElementById("messagesContainer"),s=document.createElement("div");let l=document.createElement("div");var r,c=document.createElement("div"),o=document.createElement("button"),d=document.createElement("img"),i=document.createElement("button"),u=document.createElement("span"),m=document.createElement("div");m.classList.add("message-display"),s.classList.add("message-actions"),d.classList.add("chat-pfp"),c.classList.add("userdata"),o.classList.add("username"),l.classList.add("message-content");let h;if(h=t.system?await userLookup(t.system.id||t.system.by):await userLookup(t.author),t.system)o.textContent=h[1],d.src=h[2]?`https://autumn.revolt.chat/avatars/${h[2]._id}?max_side=256`:`https://api.revolt.chat/users/${h[0]._id}/default_avatar`,"user_added"===t.system.type&&(a.textContent="User "+(await userLookup(t.system.by)?await userLookup(t.system):t.system.by)),o.onclick=()=>{loadProfile(h[0])},d.onclick=()=>{loadProfile(h[0])},c.appendChild(d),c.appendChild(o),a.appendChild(c),a.appendChild(l);else{if(t.masquerade)u.textContent="Masq",t.masquerade.name?o.textContent=t.masquerade.name:o.textContent=n.nickname||h[5]||h[1],o.appendChild(u),t.masquerade.avatar?d.src="https://jan.revolt.chat/proxy?url="+t.masquerade.avatar:(d.src=h[2]?`https://autumn.revolt.chat/avatars/${h[2]._id}?max_side=256`:`https://api.revolt.chat/users/${h[0]._id}/default_avatar`,o.style.color=t.masquerade.colour);else if(o.textContent=n.nickname||h[5],void 0!==h[3]&&(u.textContent="Bot"),o.appendChild(u),d.src=n.avatar?"https://autumn.revolt.chat/avatars/"+n.avatar._id:h[2]?`https://autumn.revolt.chat/avatars/${h[2]._id}?max_side=256`:`https://api.revolt.chat/users/${h[0]._id}/default_avatar`,n.roles)for(let e=n.roles.length+1;0<=e;e--)if(r=cacheLookup("roles",n.roles[e],activeServer).colour){if(/^#[0-9A-F]{6}$/i.test(r)){o.style.backgroundColor=r;break}o.style.background=r,o.style.backgroundClip="border-box"}if(o.onclick=()=>{loadProfile(h[0])},d.onclick=()=>{loadProfile(h[0])},c.appendChild(d),c.appendChild(o),"Blocked"!==h[6]){if(l.innerHTML=converter.makeHtml(t.content),t.mentions&&t.mentions.forEach(async e=>{if(1!==l.innerText.split(`<@${e}>`).length){let t=document.createElement("div"),n;l.innerText.split(`<@${e}>`).forEach(e=>{(n=document.createElement("span")).innerText=e,t.appendChild(n)});var a=document.createElement("div"),s=document.createElement("div"),r=document.createElement("img"),c=document.createElement("span"),o=cacheLookup("users",e);r.classList.add("mentionPfp"),c.classList.add("mentionText"),a.classList.add("tag"),a.appendChild(r),c.textContent=cacheLookup("users",e)[5],r.src=o[2]?`https://autumn.revolt.chat/avatars/${o[2]._id}?max_side=256`:`https://api.revolt.chat/users/${e}/default_avatar?max_side=256`,c.textContent=cacheLookup("users",e)[5],a.appendChild(r),a.appendChild(c),s.appendChild(a),t.insertBefore(s,n),l=t,a.onclick=()=>{loadProfile(e)},e===o._id&&l.classList.add("selfMentioned")}}),Object.keys(emojis.standard).forEach(e=>{-1!==l.textContent.search(`:${e}:`)&&(l.innerHTML=l.innerHTML.replace(`:${e}:`,emojis.standard[e]))}),Object.keys(emojis.custom).forEach(e=>{if(-1!==l.textContent.search(":"+e)){var t=l.innerHTML.split(`:${e}:`),n=document.createElement("img");n.src="https://dl.insrt.uk/projects/revolt/emotes/"+emojis.custom[e],l.replaceChildren();for(let e=0;e<t.length;e++)e!==t.length-1?l.innerHTML+=t[e]+n.outerHTML:l.innerHTML+=t[e]}}),null!==l.innerHTML.match(/:[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}:/g)){var p=l.innerHTML.match(/:[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}:/g);for(let e=0;e<p.length;e++){var g=p[e].split(":")[1],v=l.innerHTML.split(`:${g}:`),y=document.createElement("img");y.classList.add("emoji");let t="";y.src="https://autumn.revolt.chat/emojis/"+g;for(let e=1;e<v.length;e++)t+=v[e];l.innerHTML=""+v[0]+y.outerHTML+t}}if(t.replies){var f=document.createElement("div");f.classList.add("reply-content");for(let e=0;e<t.replies.length;e++){var C=document.createElement("span");C.textContent="> "+cacheLookup("messages",t.replies[e])[2]+"\n",f.appendChild(C)}m.appendChild(f)}if(0!==cache.messages.length&&cache.messages[cache.messages.length-1][1]===t.author&&void 0===cache.messages[cache.messages.length-1][3]||m.appendChild(c),m.appendChild(l),m.id=t._id,m.class="message",t.attachments){let r=document.createElement("div");r.classList.add("message-attachments"),t.attachments.forEach(e=>{let t;var n,a,s;e.content_type.startsWith("image")?(t=document.createElement("img")).src=`https://autumn.revolt.chat/attachments/${e._id}/`+e.filename:e.content_type.startsWith("video")?(n=document.createElement("source"),(t=document.createElement("video")).controls=!0,t.style.maxWidth="30%",t.style.maxHeight="30%",n.src=`https://autumn.revolt.chat/attachments/${e._id}/`+e.filename,n.type=e.content_type,t.appendChild(n)):e.content_type.startsWith("audio")?(n=document.createElement("audio"),a=document.createElement("source"),s=document.createElement("span"),t=document.createElement("div"),n.controls=!0,n.textContent=e.filename,a.src=`https://autumn.revolt.chat/attachments/${e._id}/`+e.filename,a.type=e.content_type,n.appendChild(a),s.textContent=e.filename+"\n",t.appendChild(s),t.appendChild(n)):((t=document.createElement("a")).textContent=e.filename,t.href=`https://autumn.revolt.chat/attachments/${e._id}/`+e.filename),r.appendChild(t)}),m.appendChild(r)}}else{if(t.replies){var k=document.createElement("div");k.classList.add("reply-content");for(let e=0;e<t.replies.length;e++){var b=document.createElement("span");b.textContent="> "+cacheLookup("messages",t.replies[e])[2]+"\n",k.appendChild(b)}m.appendChild(k)}0!==cache.messages.length&&cache.messages[cache.messages.length-1][1]===t.author&&void 0===cache.messages[cache.messages.length-1][3]||m.appendChild(c),m.appendChild(l),m.id=t._id,m.class="message",l.innerText="<Blocked user>",a.classList.add("blockedMessage")}i.onclick=()=>{activeReplies.push({id:t._id,mention:!1});var e=document.createElement("p");e.textContent=t.content,e.classList.add("replying-content"),document.querySelector(".replying-container").appendChild(e),scrollChatToBottom()},i.innerText="Reply",m.appendChild(s),s.appendChild(i),a.appendChild(m),cache.messages.push([t._id,t.author,t.content,t.masquerade]),scrollChatToBottom()}}async function buildChannelCache(a){for(let e=0;e<a.length;e++)switch(a[e].channel_type){case"TextChannel":cache.channels.push([a[e]._id,a[e].name,a[e].channel_type,a[e].server,a[e].last_message_id]);break;case"Group":cache.channels.push([a[e]._id,a[e].name,a[e].channel_type]);break;case"DirectMessage":cache.channels.push([a[e]._id,a[e].recipients,a[e].channel_type])}for(const e in cache.servers)cache.servers[e][5].forEach(e=>{let n=[];e.channels.forEach(e=>{let t;for(tmpChannel in a)if(a[tmpChannel]._id===e){t=tmpChannel;break}n.push(a[t])}),cache.categories.push({[e]:n})})}async function buildUserCache(t){for(let e=0;e<t.length;e++)cache.users.push([t[e]._id,t[e].username,t[e].avatar,t[e].bot,t[e].discriminator,t[e].display_name||t[e].display_name,t[e].relationship])}async function buildServerCache(t){for(let e=0;e<t.length;e++)cache.servers.push([t[e]._id,t[e].name,t[e].icon?t[e].icon._id:null,t[e].roles,[],t[e].categories,t[e].channels]);getServers()}async function getMessages(e){cache.messages=[],activeReplies=[],activeChannel=e,document.querySelector(".replying-container").replaceChildren(),document.querySelector("#typingBar").replaceChildren();var e=await fetchResource(`channels/${e}/messages?include_users=true&sort=latest`),t=e.users;for(let e=0;e<t.length;e++)1===cacheLookup("users",t[e]._id)&&cache.users.push([t[e]._id,t[e].username,t[e].avatar,t[e].bot,t[e].discriminator,t[e].display_name||t[e].username,t[e].relationship]);if(e.members){var n=e.members;for(let e=0;e<n.length;e++)1===cacheLookup("members",n[e]._id.user,activeServer)&&cache.servers[cacheIndexLookup("servers",activeServer)][4].push(n[e])}clearMessages();var a=e.messages;for(let e=a.length-1;1<=e;e--)parseMessage(a[e]);fetch(`https://api.revolt.chat/channels/${activeChannel}/ack/`+a[0]._id,{headers:{"x-session-token":token},method:"PUT"}),parseMessage(a[0])}async function loadDMs(){var e=document.getElementById("channelsContainer");let n=document.createElement("summary");n.classList.add("categoryText"),e.replaceChildren(),clearMessages(),await fetchResource(`users/${userProfile._id}/dm`).then(e=>{var t=document.createElement("button");t.textContent="Saved messages",t.classList.add("channel"),t.onclick=()=>{getMessages(e._id)},t.id=e._id,n.appendChild(t)});for(let t=0;t<cache.channels.length;t++)if(["DirectMessage","Group"].includes(cache.channels[t][2])){var a=document.createElement("button");if(a.classList.add("channel"),"Group"===cache.channels[t][2])a.textContent=cache.channels[t][1];else{let e;e=cache.channels[t][1][1]!==userProfile._id?await userLookup(cache.channels[t][1][1]):await userLookup(cache.channels[t][1][0]),a.textContent=`@${e[1]}#`+e[4]}a.onclick=()=>{getMessages(cache.channels[t][0]),document.getElementById("channelName").innerText="FIXME"},a.id=cache.channels[t][0],n.appendChild(a)}e.appendChild(n)}async function loadProfile(e){var t=await fetchResource(`users/${e}/profile`),n=cacheLookup("members",e,activeServer),e=await userLookup(e),a=document.getElementById("displayName"),s=document.getElementById("username"),r=document.getElementById("profilePicture"),c=document.getElementById("profileMedia");let o=document.getElementById("bio");var l=document.getElementById("roleContainer");if(s.textContent=e[1]+"#"+e[4],a.textContent=e[5]||e[1],e[2]?r.src="https://autumn.revolt.chat/avatars/"+e[2]._id:r.src=`https://api.revolt.chat/users/${t._id}/default_avatar`,-1<Object.keys(t).indexOf("background")?c.style.background=`linear-gradient(0deg, rgba(0,0,0,0.84) 10%, rgba(0,0,0,0) 100%),
        url(https://autumn.revolt.chat/backgrounds/${t.background._id}) center center / cover`:c.style.background="",o.innerHTML=converter.makeHtml(t.content),Object.keys(emojis.standard).forEach(e=>{-1!==o.innerHTML.search(`:${e}:`)&&(o.innerHTML=o.innerHTML.replace(`:${e}:`,emojis.standard[e]))}),Object.keys(emojis.custom).forEach(e=>{if(-1!==o.innerHTML.search(":"+e)){var t=o.innerHTML.split(`:${e}:`),n=document.createElement("img");n.classList.add("emoji"),n.src="https://dl.insrt.uk/projects/revolt/emotes/"+emojis.custom[e],o.textContent="",o.innerHTML="";for(let e=0;e<t.length;e++)e!==t.length-1?o.innerHTML+=t[e]+n.outerHTML:o.innerHTML+=t[e]}}),null!==o.innerHTML.match(/:[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}:/g)){var d=o.innerHTML.match(/:[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}:/g);for(let e=0;e<d.length;e++){var i=d[e].split(":")[1],u=o.innerHTML.split(`:${i}:`),m=document.createElement("img");m.classList.add("emoji"),m.src="https://autumn.revolt.chat/emojis/"+i,o.innerHTML=u[0]+m.outerHTML;for(let e=1;e<u.length;e++)o.innerHTML+=u[e]}}if(l.replaceChildren(),n.roles)for(let e=0;e<n.roles.length;e++){var h=document.createElement("span"),p=cacheLookup("roles",n.roles[e],activeServer);h.classList.add("tag"),h.textContent=p.name,h.style.color=p.colour,l.appendChild(h)}document.getElementById("userProfile").style.display="flex"}async function sendMessage(){if(!isMessageSending){var n=document.getElementById("input"),a=n.value;let e=void 0,t=void 0;(document.querySelector("#embedTitle").value||document.querySelector("#embedDesc").value||document.querySelector("#embedColour").value||document.querySelector("#embedIconURL").value||document.querySelector("#embedMedia").value||document.querySelector("#embedURL").value)&&(e=[{title:document.querySelector("#embedTitle").value?document.querySelector("#embedTitle").value:null,description:document.querySelector("#embedDesc").value?document.querySelector("#embedDesc").value:null,colour:document.querySelector("#embedColour").value?document.querySelector("#embedColour").value:null,icon_url:document.querySelector("#embedIconURL").value?document.querySelector("#embedIconURL").value:null,url:document.querySelector("#embedURL").value?document.querySelector("#embedURL").value:null,media:document.querySelector("#embedMedia").value?document.querySelector("#embedMedia").value:null}]),(document.querySelector("#masqName").value||document.querySelector("#masqPfp").value||document.querySelector("#masqColour").value)&&(t={name:document.querySelector("#masqName").value?document.querySelector("#masqName").value:null,avatar:document.querySelector("#masqPfp").value?document.querySelector("#masqPfp").value:null,colour:document.querySelector("#masqColour").value?document.querySelector("#masqColour").value:null});a=sendRawJSON?a:JSON.stringify({content:a,replies:activeReplies,masquerade:t,embeds:e});isMessageSending=!0,await fetch(`https://api.revolt.chat/channels/${activeChannel}/messages`,{headers:{"x-session-token":token},method:"POST",body:a}).then(e=>e.json()).then(e=>{isMessageSending=!1,fetch(`https://api.revolt.chat/channels/${activeChannel}/ack/`+e._id,{method:"PUT",headers:{"x-session-token":token}})}),n.value="",activeReplies=[],document.querySelector(".replying-container").replaceChildren(),scrollChatToBottom()}}window.onload=function(){localStorage.getItem("token")&&(token=localStorage.getItem("token"),login())},document.addEventListener("keydown",e=>{switch(e.key){case"Enter":var t;-1===keysDown.indexOf("Shift")?sendMessage():(t=document.getElementById("input")).value=t.value+`
`;break;case"Escape":activeReplies.pop(),document.querySelector(".replying-container").lastChild.remove();break;default:keysDown.push(e.key)}}),document.addEventListener("keyup",e=>{keysDown.splice(keysDown.indexOf(e.key),1)});let toolbar=document.querySelector(".toolbar"),toolbarBtn=document.querySelector(".toolbar-btn");function scrollChatToBottom(){var e=document.getElementById("messagesContainer");e.scrollTo(0,e.scrollHeight)}function openSettings(){document.querySelector("#settings").style.display="flex"}function closeSettings(){document.querySelector("#settings").style.display="none"}function loadSetting(e){"behaviour"===e&&(document.querySelector("mainSettings"),document.querySelector("#settingCatName").innerText="Behaviour")}function setSetting(e,t){localStorage.setItem(e,t)}function loadSetting(e){return localStorage.getItem(e)}function createSettingDiv(e,t){}toolbarBtn.addEventListener("click",()=>{toolbar.classList.toggle("show-toolbar")});
//# sourceMappingURL=main.js.map